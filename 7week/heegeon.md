# 6. DML 튜닝

## 6.1 기본 DML 튜닝

### DML 성능에 영향을 미치는 요소
- 인덱스
- 무결성 제약
- 조건절
- 서브쿼리
- Redo 로깅
- Undo 로깅
- Lock
- 커밋

테이블에 레코드를 입력하면 인덱스에도 입력해야 하는데 테이블은 Freelist라는 입력 블록을 할당받지만 인덱스는 정렬된 자료구조이므로 수직적 탐색을 통해 입력할 블록을 찾아야 한다.
<br>

#### Redo 로깅과 DML 성능
오라클은 데이터파일과 컨트롤 파일에 가해지는 모든 변경사항을 Redo 로그에 기록한다.
<br>
이 Redo 로그는 트랜잭션 데이터가 어떤 이유에서건 유실됐을 때, 트랜잭션을 재현함으로써 유실 이전 상태로 복구하는 데 사용된다.

DML을 수행할 때 Redo 로그를 생성해야 하므로 Redo 로깅은 DML 성능에 영향을 미친다.

#### Undo 로깅과 DML 성능
Redo는 트랜잭션을 재현함으로써 과거를 현재 상태로 되돌리는 데 사용하고 Undo는 트랜잭션을 롤백함으로써 현재를 과거 상태로 되돌리는 데 사용된다.

DML을 수행할 때마다 Undo를 생성하기 때문에 Undo 로그는 성능에 영향을 미친다.

### 데이터베이스 Call과 성능
SQL은 아래 세 단계로 나누어 실행된다.
1. Parse Call: SQL 파싱과 최적화 수행
2. Execute Call: SQL 실행 / DML은 이 단계에서 끝나지만 SELECT는 Fetch Call까지 진행
3. Fetch Call: 데이터 조회 / SELECT문에서만 발생

Call의 발생 위치에 따라 User Call, Recursive Call로 나뉘는데 User Call은 네트워크를 경유하기 때문에 성능에 미치는 영향이 크다.

### 인덱스 및 제약 해제를 통한 대량 DML 튜닝
인덱스와 무결성 제약 조건은 DML 성능에 큰 영향을 끼치기 때문에 이 기능을 해제함으로써 배체 프로그램에서 큰 성능개선 효과를 얻을 수 있다.

### 수정가능 조인 뷰
수정가능 조인 뷰는 DML을 수행할 수 있는 뷰로, 뷰를 통해 테이블을 수정할 수 있다.
```sql
UPDATE (SELECT * FROM emp WHERE deptno = 10) SET sal = sal * 1.1;
```
위의 쿼리는 12c 이상의 버전에서만 동작한다.

### Merge문 활용
Merge문은 Update + Insert를 한 번에 수행할 수 있는 문장이다.

기억할 점은 Merge 문에서 Update가 이루어진 결과로서 NULL이 아닌 레코드만 삭제한다는 사실이다.
<br>
또, Merge문 Delete 절은 조인에 성공한 데이터만 삭제할 수 있다.

## 6.2 Direct Path I/O 활용
오라클은 대량 데이터를 처리하는 배치 프로그램을 위해 버퍼캐시를 경유하지 않고 곧바로 데이터 블록을 읽고 쓸 수 있는 Direct Path I/O를 제공한다.

자주 읽는 블록에 대한 반복적인 I/O Call을 줄임으로써 시스템 전반적인 성능을 높이기 위해 버퍼캐시를 이용하지만, 대량 데이터를 읽고 쓸 때 건건이 버퍼캐시를 탐색하면 성능이 떨어지므로 Direct Path I/O를 사용한다.


